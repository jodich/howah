!function(e){var o={};function s(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=o,s.d=function(e,o,t){s.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,o){if(1&o&&(e=s(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)s.d(t,r,function(o){return e[o]}.bind(null,r));return t},s.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(o,"a",o),o},s.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},s.p="/",s(s.s=4)}([function(e,o){e.exports=require("path")},function(e,o){e.exports=require("webpack")},function(e,o){e.exports=require("cloudinary")},function(e,o,s){"use strict";var t=s(14),r=s(15);if(process.env.DATABASE_URL)var n=r.parse(process.env.DATABASE_URL),i=n.auth.split(":"),u={user:i[0],password:i[1],host:n.hostname,port:n.port,database:n.pathname.split("/")[1],ssl:!0};else u={user:"jodich",host:"127.0.0.1",database:"howah",port:5432};var a=new t.Pool(u);e.exports=a},function(e,o,s){"use strict";var t=s(5),r=t(),n=s(1),i=s(6),u=s(7),a=s(8),p=n(a),l=s(10),c=(s(0).resolve,s(11),s(2)),d=s(0);console.log("the process environment is:","production"),r.use(i(p,{publicPath:a.output.publicPath,stats:{colors:!0}})),r.use(u(p)),r.use(t.static("./public")),r.use(t.json()),r.use(t.urlencoded({extended:!0})),r.use(l()),c.config({cloud_name:"db2fpatds",api_key:"491492416143532",api_secret:"UhXNYUV93GaYh_h0kONJYI0H61I"}),r.use(t.static(__dirname)),s(12)(r),r.get("*",function(e,o){o.sendFile(d.resolve(__dirname,"index.html"))});r.listen(process.env.PORT||3e3,function(){console.log("listening on port 3000")})},function(e,o){e.exports=require("express")},function(e,o){e.exports=require("webpack-dev-middleware")},function(e,o){e.exports=require("webpack-hot-middleware")},function(e,o,s){"use strict";var t=s(0),r=(s(1),s(9));e.exports={entry:{main:"./src/client/index.jsx"},output:{path:t.join(__dirname,"..","dist"),publicPath:"/",filename:"[name].js"},target:"web",mode:"production",devtool:"#source-map",module:{rules:[{test:/\.(js|jsx)$/,exclude:/node_modules/,use:["babel-loader"]},{test:/\.s?css$/,use:["style-loader","css-loader","sass-loader"]}]},resolve:{extensions:["*",".js",".jsx"]},plugins:[new r({template:"./public/index.html",filename:"./index.html"})]}},function(e,o){e.exports=require("html-webpack-plugin")},function(e,o){e.exports=require("cookie-parser")},function(e,o){e.exports=require("express-history-api-fallback")},function(e,o,s){"use strict";var t=s(13),r=s(16),n=s(18),i=n({storage:n.memoryStorage()});e.exports=function(e){e.post("/api/submit-new-user",r.postNewUser),e.post("/api/submit-login",r.postUserLogin),e.get("/api/categories",t.selectCategories),e.post("/api/posts/:id/option/:optionId",t.voting),e.get("/api/posts/:id",t.selectSpecificPost),e.get("/api/posts",t.selectPosts),e.get("/api/userposts",r.selectUserPosts),e.post("/api/submit-new-post",t.postNewPost),e.post("/api/upload-image",i.single("image"),t.postImage)}},function(e,o,s){"use strict";var t=s(3),r=s(2);e.exports={selectCategories:function(e,o){t.query("SELECT * FROM categories",function(e,s){o.json(s.rows)})},selectPosts:function(e,o){var s=[parseInt(e.query.limit)];console.log(s),t.query("SELECT * FROM posts WHERE current_timestamp < deadline ORDER BY id LIMIT $1",s,function(e,s){e&&console.log(e),o.json({postsArr:s.rows})})},selectSpecificPost:function(e,o){var s=[e.params.id];t.query("SELECT *, AGE(deadline, current_timestamp::timestamp(0)) FROM posts WHERE id = $1",s,function(e,r){var n=r.rows[0];t.query("SELECT * FROM options WHERE post_id = $1 ORDER BY id",s,function(e,s){var t=s.rows;o.json({post:n,options:t})})})},postNewPost:function(e,o){var s=e.body,r=s.title,n=s.question,i=s.questionImg,u=s.time,a=s.date,p=s.userId,l=s.images,c=s.options,d=(function(e,o){var s={};for(var t in e)o.indexOf(t)>=0||Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}(s,["title","question","questionImg","time","date","userId","images","options"]),{}),f=function(e,o){for(var s in e){var t=s.split("_")[1];d[t]||(d[t]=[null,null]),d[t][o]=e[s]}};if(f(c,0),f(l,1),a)var m=a.split("/").reverse().join("-")+" "+u+":00";var E=[r,n,i,p,m];t.query("INSERT INTO posts (title, question, question_image, author_id, deadline) VALUES ($1, $2, $3, $4, $5) RETURNING *",E,function(e,s){e&&console.log(e);var r="INSERT INTO options (post_id, option, option_image) VALUES ",n=s.rows[0].id,i=[];for(var u in d){var a=d[u][0],p=d[u][1],l="("+n+", '"+a+"', '"+p+"')";i.push(l)}r=r+i.join(", ")+" RETURNING *",t.query(r,function(e,s){e&&console.log(e),o.json({postId:n,status:!0})})})},voting:function(e,o){var s=e.cookies.user_id,r=e.params.id,n=e.params.optionId,i=[r];t.query("SELECT * FROM posts WHERE id = $1 AND current_timestamp > deadline",i,function(e,i){if(e&&console.log(e),i.rows.length<1){var u=[s,r];t.query("SELECT * FROM votes WHERE user_id = $1 AND post_id = $2",u,function(e,i){if(e&&console.log(e),i.rows.length<1){var u=[s,r,n];t.query("INSERT INTO votes (user_id, post_id, option_id) VALUES ($1, $2, $3)",u,function(e,s){e&&console.log(e);var r=[n,n];t.query("UPDATE options SET points = (SELECT COUNT(option_id) FROM votes WHERE option_id = $1) WHERE id = $2 RETURNING *",r,function(e,s){e?console.log(e):o.json({message:"Your vote has been placed!",updatedOption:s.rows[0],status:!0})})})}else o.json({message:"You have already voted",status:!1})})}else o.json({message:"The time is up!",status:!1})})},postImage:function(e,o){r.uploader.upload_stream(function(e){o.json({url:e.secure_url,uploaded:!0})}).end(e.file.buffer)}}},function(e,o){e.exports=require("pg")},function(e,o){e.exports=require("url")},function(e,o,s){"use strict";var t=s(3),r=s(17);e.exports={postNewUser:function(e,o){var s=e.body,n=s.name,i=s.email,u=s.password,a=s.cmfpassword;if(u==a){var p=[i];t.query("SELECT * FROM users WHERE email = $1",p,function(e,s){if(e&&console.log(e),s.rows.length<1){var a=[n,i,r(u)];t.query("INSERT INTO users (user_name, email, password) VALUES ($1, $2, $3) RETURNING *",a,function(e,s){e&&console.log(e),o.cookie("user_id",s.rows[0].id),o.json({result:s.rows[0],message:"successfully created user",loginStatus:!0})})}else o.json({message:"email already exists",loginStatus:!1})})}else o.json({message:"password does not match",loginStatus:!1})},postUserLogin:function(e,o){var s=e.body,n=s.email,i=s.password,u=[n,r(i)];t.query("SELECT * FROM users WHERE email = $1 and password = $2",u,function(e,s){s.rows.length>0?(o.cookie("user_id",s.rows[0].id),o.json({result:s.rows[0],message:"successfully logged in",loginStatus:!0})):o.json({message:"either email or password wrong",loginStatus:!1})})},selectUserPosts:function(e,o){var s=e.cookies.user_id,r=e.query.length,n="";switch(e.query.sortby){case"recent":n="SELECT * FROM posts WHERE author_id = $1 ORDER BY id DESC LIMIT $2";break;case"open":n="SELECT * FROM posts WHERE author_id = $1 AND current_timestamp < deadline ORDER BY id DESC LIMIT $2";break;case"closed":n="SELECT * FROM posts WHERE author_id = $1 AND current_timestamp > deadline ORDER BY id DESC LIMIT $2";break;default:n="SELECT * FROM posts WHERE author_id = $1 ORDER BY id ASC LIMIT $2"}var i=[s,r];t.query(n,i,function(e,s){e&&console.log(e),o.json({posts:s.rows})})}}},function(e,o){e.exports=require("js-sha256")},function(e,o){e.exports=require("multer")}]);